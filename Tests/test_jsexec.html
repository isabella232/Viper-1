<html>
    <head></head>
    <body spellcheck="false" onload="document.getElementById('jsExec').focus()">
        <img src="Core/Images/window-target2.png" onclick="window.close();" />
        <textarea id="jsExec" accesskey="J"></textarea>
        <textarea id="jsRes" accesskey="R"></textarea>
        <button id="close" onclick="document.getElementById('jsExec').value='';document.getElementById('jsRes').value='';">Clear</button>
        <script>
            var jsCache = window.opener.jsCache || [];
            var jsExec = document.getElementById('jsExec')
            var jsRes  = document.getElementById('jsRes');
            jsExec.onkeydown = function(e) {
                if (e.which !== 13) {
                    return;
                }

                var val      = jsExec.value;
                jsRes.value  = '';
                jsExec.value = '';

                if (isNaN(parseInt(val)) === false) {
                    val = jsCache[val];
                } else {
                    jsCache.push(val);
                }

                window.opener.dfx.setHtml(window.opener.dfx.getId('msg'), 'Exec: ' + val);

                if (val === 'cw()' || val === 'cw();') {
                    // Close this popup.
                    cw();
                    return;
                }

                val  = 'var jsResult = window.opener.' + val + ';';
                val += 'jsRes.value = window.opener.dfx.jsonEncode(jsResult);';

                // Execute JS.
                eval(val);
            };

            function cw()
            {
                window.close();
            }
        </script>
    </body>
</html>
