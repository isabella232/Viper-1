<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
    <head>
        <title>Running: __TEST_TITLE__</title>
        __TEST_VIPER_INCLUDE__
        <script type="text/javascript" src="./test.js"></script>
        <link rel="stylesheet" media="screen" href="./test.css" />
        __TEST_JS_INCLUDE__
        <script type="text/javascript">
            var viper   = null;
            var jsCache = __TEST_JS_EXEC_CACHE__;
            ViperReadyCallback = function() {
                var contentElement = dfx.getId('content');

                viper = new Viper('test', null, null, [contentElement]);
                viper.getPluginManager().setPlugins(['ViperCoreStylesPlugin', 'ViperKeyboardEditorPlugin', 'ViperInlineToolbarPlugin', 'ViperHistoryPlugin', 'ViperListPlugin', 'ViperFormatPlugin', 'ViperToolbarPlugin', 'ViperTableEditorPlugin', 'ViperCopyPastePlugin', 'ViperImagePlugin', 'ViperLinkPlugin', 'ViperAccessibilityPlugin', 'ViperSourceViewPlugin', 'ViperSearchReplacePlugin', 'ViperLangToolsPlugin', 'ViperCharMapPlugin', 'ViperTrackChangesPlugin']);

                dfx.attr(dfxjQuery.find('.Viper-button[title]'), 'title', '');
                if (window.location.hash !== '#run') {
                    window.open('test_jsexec.html', '', 'width=400,height=100,0,status=0,left=1000,top=850');
                    window.location.hash = '#run';
                }

                var readyCallbacks = viperTest.getReadyCallbacks();
                if (readyCallbacks) {
                    for (var i = 0; i < readyCallbacks.length; i++) {
                        readyCallbacks[i].call(this);
                    }
                }

                // Check for test cases.
                var testCases = dfx.find(contentElement, 'div[id^="test"]');
                if (testCases.length > 0) {
                    var testCasesHtml = [];
                    for (var i = 0; i < testCases.length; i++) {
                        testCasesHtml[testCases[i].id] = dfx.getHtml(testCases[i]);
                    }

                    viperTest.set('testCases', testCasesHtml);
                    dfx.empty(contentElement);
                }
            };
        </script>
    </head>
    <body spellcheck="false">
        <img id="windowTarget" src="./Core/Images/window-target.png" onclick="if (viper) viper.destroy();location.reload();" />
        <div id="content">__TEST_CONTENT__</div>
        <div id="menu">
            <div id="testTitle"><em>Running:</em> __TEST_TITLE__<em id="testCaseTitle"></em></div>
            <div id="msg"></div>
        </div>
        <script>
            if (window['Viper'] && Viper.build === true) {
                ViperReadyCallback();
            }
        </script>
    </body>
</html>
